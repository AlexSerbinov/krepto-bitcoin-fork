# Автоматичне Підлаштування Складності в Krepto

## Огляд

Krepto використовує той самий алгоритм підлаштування складності, що й Bitcoin. Складність автоматично змінюється кожні 2016 блоків, щоб підтримувати середній час блоку близько 10 хвилин.

## Ключові Параметри

```cpp
consensus.nPowTargetTimespan = 14 * 24 * 60 * 60; // 2 тижні (1,209,600 секунд)
consensus.nPowTargetSpacing = 10 * 60;            // 10 хвилин (600 секунд)
consensus.fPowNoRetargeting = false;              // Підлаштування УВІМКНЕНО
consensus.nMinerConfirmationWindow = 2016;        // Інтервал підлаштування
```

## Як Працює Алгоритм

### 1. Інтервал Підлаштування
- **Частота**: Кожні 2016 блоків
- **Цільовий час**: 14 днів для 2016 блоків
- **Цільовий час блоку**: 10 хвилин

### 2. Формула Розрахунку

```
Нова_Складність = Стара_Складність × (Фактичний_Час / Цільовий_Час)
```

Де:
- `Фактичний_Час` = час між першим і останнім блоком періоду
- `Цільовий_Час` = 1,209,600 секунд (2 тижні)

### 3. Обмеження Зміни

Щоб запобігти різким стрибкам складності:
- **Максимальне збільшення**: в 4 рази
- **Максимальне зменшення**: в 4 рази

```cpp
if (nActualTimespan < params.nPowTargetTimespan/4)
    nActualTimespan = params.nPowTargetTimespan/4;
if (nActualTimespan > params.nPowTargetTimespan*4)
    nActualTimespan = params.nPowTargetTimespan*4;
```

## Поточний Стан Мережі

### Чому Блоки Знаходяться Швидко?

1. **Початкова складність занадто низька**: `0.000244140625`
2. **Ще не було підлаштування**: потрібно дочекатися блоку 2016
3. **Мінімальна складність**: встановлена в genesis блоці

### Перше Підлаштування

Перше підлаштування складності відбудеться на блоці **2016**. Після цього:

- Складність значно зросте
- Час блоків наблизиться до 10 хвилин
- Мережа стане більш стабільною

## Моніторинг Складності

### Команди для Перевірки

```bash
# Поточна складність
./src/bitcoin-cli -datadir=/Users/serbinov/.krepto getmininginfo

# Інформація про блокчейн
./src/bitcoin-cli -datadir=/Users/serbinov/.krepto getblockchaininfo

# Хешрейт мережі
./src/bitcoin-cli -datadir=/Users/serbinov/.krepto getnetworkhashps
```

### Ключові Метрики

- **difficulty**: Поточна складність
- **networkhashps**: Хешрейт мережі (хеші/секунду)
- **blocks**: Поточна висота блоку

## Прискорене Тестування

Для демонстрації підлаштування складності:

```bash
# Швидкий майнінг до блоку 2016
./mine_to_retarget.sh
```

Цей скрипт:
1. Майнить блоки батчами по 100
2. Показує прогрес кожні 500 блоків
3. Зупиняється на блоці 2016
4. Показує нову складність після підлаштування

## Очікувані Результати

### До Блоку 2016
- Складність: `0.000244140625` (мінімальна)
- Час блоку: ~0.5-2 секунди
- Хешрейт: ~5,000 H/s

### Після Блоку 2016
- Складність: Значно вища (залежить від фактичного часу)
- Час блоку: Ближче до 10 хвилин
- Хешрейт: Той самий, але ефективність нижча

## Налаштування для Розробки

Якщо потрібно швидше тестування, можна змінити параметри:

```cpp
// Для швидшого підлаштування (тільки для тестування!)
consensus.nPowTargetTimespan = 60;     // 1 хвилина
consensus.nPowTargetSpacing = 10;      // 10 секунд
consensus.nMinerConfirmationWindow = 6; // Кожні 6 блоків
```

⚠️ **Увага**: Зміна цих параметрів створить несумісний форк!

## Висновок

Автоматичне підлаштування складності в Krepto працює правильно, але:

1. **Зараз**: Складність мінімальна, блоки швидкі
2. **Після блоку 2016**: Складність підлаштується, час блоків стабілізується
3. **Довгостроково**: Мережа автоматично підтримуватиме 10-хвилинні блоки

Це нормальна поведінка для нової мережі з низькою початковою складністю. 